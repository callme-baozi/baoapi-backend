**API接口开放平台**

**技术栈**：Springboot+Mybatis plus+Dubbo+nacos+Spring Cloud Gateway

**项目描述**：该项目是提供 API 接口供开发者调用的平台。管理员可以接入并发布接口，统计分析各接口调用情况；用户可以注册登录并开通接口调用权限，然后可以浏览接口及在线调试，开发者还能使用客户端 SDK 轻松在代码中调用接口。项目包括多个子系统。

**技术描述**：

1. 使用Gateway网关做统一用户鉴权（API 签名认证）及接口调用次数统计
2. 使用Dubbo分布式服务架构将主系统的获取用户、接口、统计调用次数等信息的接口注册到注册中心，提供给网关系统使用做信息获取和校验
3. 通过导入自定义客户端SDK访问模拟接口



用户注册

- 采用盐值拼接密码做md5加密
- ak、s通过盐值拼接密码和随机数的md5加密，自动分配
- 注册成功返回用户id（mysql自增主键）

用户登录

- 通过相同的方法（盐值拼接密码做md5加密）得到密码，再查找数据库比对

- 通过request/session记录用户的登录态

  ```java
  request.getSession().setAttribute(USER_LOGIN_STATE, user);
  ```

接口发布、更新、下线、获取

- 检验用户身份（是否为管理员，通过自定义注解实现）

网关作用

- 通过把主系统的获取用户、接口、统计调用次数等信息的接口注册到注册中心，提供给网关系统做信息获取和校验
- 通过配置式编程拦截所有匹配请求前缀的请求，做统一用户鉴权、访问控制、和接口调用成功后的次数统计。
- 【可选】使用流量染色给请求的请求头增加信息，防止绕过网关调用接口。
- 【疑问】所有请求都拦截了，用户注册那些都被拦截了，请求头中没有ak等信息，不就被拒绝了吗

系统分工

- backend：主系统，包括用户和接口的管理
- common：提供公共类和方法，给其他系统需要统一类信息的地方引用
- client-sdk：客户端SDK，调用模拟接口（使用HTTP协议），对外提供配置，就可以自动注入，像使用方法一样调用接口
- gateway：网关系统，独立运行，拦截请求，并做一些处理
- interface：模拟接口，给api开放平台提供可调用的接口。

Dubbo

- Dubbo是阿里巴巴的一款高性能、轻量级的分布式服务框架
- 基于Java语言的RPC（Remote Procedure Call，远程过程调用）协议进行通信，支持多种语言和开发框架

API 签名认证

- API签名认证是一种在API调用中使用的身份验证机制，目的是确保API请求来自于合法的发起方并且未被篡改。两部分组成：API密钥和API密钥的密钥。（access key 访问秘钥 secret key 秘钥）
